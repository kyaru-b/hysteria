# 3X-UI + Nginx Reverse Proxy

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–Ω–µ–ª–∏ 3X-UI —Å Nginx reverse proxy –∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º Let's Encrypt.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- –î–æ–º–µ–Ω, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä (A-–∑–∞–ø–∏—Å—å)
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: 80, 443 –∏ –ø–æ—Ä—Ç—ã –¥–ª—è Xray

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### Linux/macOS:
```bash
chmod +x setup.sh
./setup.sh
```

### Windows (PowerShell):
```powershell
.\setup.ps1
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf          # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îÇ   ‚îî‚îÄ‚îÄ conf.d/
‚îÇ       ‚îî‚îÄ‚îÄ default.conf    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞
‚îú‚îÄ‚îÄ 3x-ui/
‚îÇ   ‚îú‚îÄ‚îÄ db/                 # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö 3x-ui
‚îÇ   ‚îî‚îÄ‚îÄ cert/               # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îú‚îÄ‚îÄ certbot/
‚îÇ   ‚îú‚îÄ‚îÄ www/                # ACME challenge
‚îÇ   ‚îî‚îÄ‚îÄ conf/               # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îú‚îÄ‚îÄ setup.sh                # –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (Linux)
‚îú‚îÄ‚îÄ setup.ps1               # –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (Windows)
‚îî‚îÄ‚îÄ credentials.txt         # –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ (–ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
```

## üîå –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã

### TCP –ø–æ—Ä—Ç—ã (Xray, VLESS, VMess, Trojan)

| –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| 80 | HTTP (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS) |
| 443 | HTTPS (–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è) |
| 2053 | –ü–∞–Ω–µ–ª—å 3X-UI (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) |
| 10000-10050 | Xray –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| 20000-20050 | Xray –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| 30000-30050 | Xray –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| 40000-40050 | Xray –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| 8080, 8443, 9443 | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Xray –ø–æ—Ä—Ç—ã |
| 2083, 2087, 2096 | Cloudflare-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–æ—Ä—Ç—ã |

### UDP –ø–æ—Ä—Ç—ã (Hysteria 2, QUIC)

| –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| 443/udp | Hysteria 2 (–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ HTTPS) |
| 8443/udp | Hysteria 2 |
| 4433, 5443, 6443, 7443/udp | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Hysteria 2 |
| 10080, 10443/udp | Hysteria 2 |
| 50000-50050/udp | Hysteria 2 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| 51000-51050/udp | Hysteria 2 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| 52000-52050/udp | Hysteria 2 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |

## üõ† –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ/—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä**

2. **–ò–∑–º–µ–Ω–∏—Ç–µ –¥–æ–º–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   ```bash
   # –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_DOMAIN.COM –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
   sed -i 's/YOUR_DOMAIN.COM/your-domain.com/g' nginx/conf.d/default.conf
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
   ```bash
   mkdir -p nginx/conf.d 3x-ui/db 3x-ui/cert certbot/www certbot/conf
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**
   ```bash
   docker-compose up -d
   ```

5. **–ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:**
   ```bash
   docker-compose run --rm certbot certonly --webroot \
       --webroot-path=/var/www/certbot \
       --email your@email.com \
       --agree-tos \
       -d your-domain.com
   ```

6. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx –¥–ª—è SSL –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:**
   ```bash
   docker-compose restart nginx
   ```

## üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –õ–æ–≥–∏ 3x-ui
docker-compose logs -f 3x-ui

# –õ–æ–≥–∏ nginx
docker-compose logs -f nginx

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
docker-compose pull
docker-compose up -d

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 3x-ui
docker exec -it 3x-ui bash
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å** –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ –ø–∞–Ω–µ–ª—å
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Firewall** - –æ—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
3. **–í–∫–ª—é—á–∏—Ç–µ Fail2Ban** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏** –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

## ‚ö° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Hysteria 2

Hysteria 2 - –±—ã—Å—Ç—Ä—ã–π UDP-–ø—Ä–æ—Ç–æ–∫–æ–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ QUIC. –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ 3X-UI:

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Inbounds** ‚Üí **Add Inbound**
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª: **Hysteria2**
4. –£–∫–∞–∂–∏—Ç–µ –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: `50000` –∏–ª–∏ –ª—é–±–æ–π –∏–∑ UDP –¥–∏–∞–ø–∞–∑–æ–Ω–∞)
5. –ó–∞–≥—Ä—É–∑–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **Up/Down Mbps**: —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - **Obfuscation**: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è Hysteria 2:
- `443/udp` - –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ HTTPS/QUIC
- `8443/udp` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π HTTPS
- `50000-50050/udp` - –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

### –í–∞–∂–Ω–æ –¥–ª—è Firewall:
```bash
# UFW (Ubuntu/Debian)
ufw allow 50000:50050/udp
ufw allow 443/udp

# firewalld (CentOS/RHEL)  
firewall-cmd --permanent --add-port=50000-50050/udp
firewall-cmd --permanent --add-port=443/udp
firewall-cmd --reload
```

## üîÑ –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ SSL

Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã. –î–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
docker-compose run --rm certbot renew
docker-compose restart nginx
```

## ‚ùì –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç
netstat -tlnp | grep :80
# –∏–ª–∏
ss -tlnp | grep :80
```

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
dig your-domain.com

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
curl -v http://your-domain.com/.well-known/acme-challenge/test
```

### –ü–∞–Ω–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs 3x-ui
docker-compose logs nginx
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- [3X-UI GitHub](https://github.com/MHSanaei/3x-ui)
- [Xray-core Documentation](https://xtls.github.io/)
